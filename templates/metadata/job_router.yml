job_types:
- name: router
  resource_label: Router / Load Balancer
  templates:
    # ship all the logs
    - {name: remote-syslog, release: simple-remote-syslog}
    # run service broker
    - {name: broker, release: dingo-postgresql}
    # run haproxy & co
    - {name: router, release: dingo-postgresql}
  static_ip: 1
  dynamic_ip: 0
  max_in_flight: 500
  resource_definitions:
    - name: ram
      type: integer
      configurable: true
      default: 2048
      constraints:
        min: 1024
    - name: ephemeral_disk
      type: integer
      configurable: true
      default: 10240
      constraints:
        min: 10240
    - name: persistent_disk
      type: integer
      configurable: true
      default: 10240
      constraints:
        min: 10240
    - name: cpu
      type: integer
      configurable: true
      default: 1
  instance_definitions:
    - name: instances
      type: integer
      configurable: true
      default: 1
      min: 1
      max: 1
  property_blueprints:
    - name: vm_credentials
      type: salted_credentials
      default:
        identity: vcap
  manifest: |
    remote_syslog:
      address: (( .properties.syslog_address.value ))
      port: (( .properties.syslog_port.value ))
      short_hostname: true
    etcd:
      machines: (( .etcd.ips ))
    backups:
      clusterdata:
        aws_access_key_id: (( .properties.clusterdata_aws_access_key.value ))
        aws_secret_access_key: (( .properties.clusterdata_aws_secret_key.value ))
        bucket_name: (( .properties.clusterdata_s3_bucket.value ))
        region: (( .properties.clusterdata_s3_region.value ))
    servicebroker:
      username: (( .properties.broker_username.value ))
      password: (( .properties.broker_password.value ))
      machines: [127.0.0.1]
      public_port: 8888
      port: 8889
      router:
        hostname: (( first_ip ))
      backends:
        username: (( .properties.backend_broker_username.value ))
        password: (( .properties.backend_broker_password.value ))
        machines:
          z1: (( .cell_z1.ips ))
          z2: (( .cell_z2.ips ))
      services:
      - name: dingo-postgresql
        description: Dedicated PostgreSQL 9.5
        id: (( .properties.service_uuid.value ))
        bindable: true
        metadata:
          providerdisplayname: Dingo Tiles
          displayname: Dingo PostgreSQL
          longdescription: PostgreSQL 9.5 in a dedicated, highly-available cluster that is continously archived to allow future for disaster recovery.
          documentationurl: https://alpha.dingotiles.com/dingo-postgresql
          supporturl: https://slack.dingotiles.com
        tags: [postgresql95, postgresql, dingo-postgresql, dingo-postgresql95, sql, database_url]
        plans:
        - name: cluster
          description: Dedicated, highly-available cluster that is continously archived
          id: (( .properties.solo_service_plan_uuid.value ))
          free: true
          metadata:
            displayname: Cluster
            bullets:
            - PostgreSQL 9.5
            - Dedicated secure containers
            - Highly-available cluster across availability zones
            - Continuously archived for potential disaster recovery
